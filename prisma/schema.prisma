// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model OptionSnapshot {
  id         BigInt   @id @default(autoincrement())
  symbol     String
  snapshotAt DateTime @default(now()) @db.Timestamptz(3)
  data       Json

  @@index([symbol, snapshotAt])
}

model Watchlist {
  id        Int        @id @default(autoincrement())
  symbol    String     @unique
  name      String?
  exchange  String?
  provider  String     @default("yahoo")
  addedAt   DateTime   @default(now())
  ivHistory IvHistory[]
}

model IvHistory {
  id          Int      @id @default(autoincrement())
  symbol      String
  contractID  String
  expiration  String
  iv          Float
  date        DateTime
  watchlistId Int
  watchlist   Watchlist @relation(fields: [watchlistId], references: [id])

  @@index([symbol, date])
}